{% extends "e-com/base.html" %}
{% block title %}Home - NK Mart{% endblock %}

{% block content %}
<style>
  /* Core layout */
  .hero-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--glass, rgba(255,255,255,0.08));
    padding: 50px;
    border-radius: 20px;
    box-shadow: var(--card-shadow);
    margin: 30px auto;
    max-width: 1200px;
  }

  .hero-section h1 {
    font-size: 38px;
    font-weight: 700;
    color: var(--highlight, #ffeb3b);
  }

  .hero-section p {
    color: var(--text-color);
    font-size: 17px;
    opacity: 0.85;
    margin-top: 10px;
  }

  .hero-section img {
    width: 350px;
    border-radius: 18px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
  }

  /* Category Grid */
  .category-section {
    margin: 60px auto;
    text-align: center;
    max-width: 1200px;
  }

  .category-section h2 {
    color: var(--highlight);
    font-size: 28px;
    margin-bottom: 25px;
  }

  .category-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 24px;
  }

  .category-card {
    background: var(--glass);
    border-radius: 16px;
    padding: 25px;
    transition: all 0.3s ease;
    box-shadow: var(--card-shadow);
  }

  .category-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  }

  .category-card img {
    width: 80px;
    height: 80px;
    object-fit: contain;
    margin-bottom: 10px;
  }

  /* Flash Deals / Featured Products */
  .flash-deals {
    max-width: 1200px;
    margin: 70px auto;
  }

  .flash-deals h2 {
    font-size: 28px;
    color: var(--highlight);
    margin-bottom: 25px;
  }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 24px;
  }

  .product-card {
    background: var(--glass);
    border-radius: 16px;
    overflow: hidden;
    text-align: center;
    box-shadow: var(--card-shadow);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
  }

  .product-card img {
    width: 100%;
    height: 220px;
    object-fit: cover;
  }

  .product-card h3 {
    margin-top: 10px;
    font-size: 18px;
  }

  .product-card .price {
    color: var(--highlight);
    font-weight: 700;
    margin: 5px 0;
  }

  .add-btn {
    background: linear-gradient(90deg, var(--accent-blue), var(--accent-blue-2));
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 10px 18px;
    cursor: pointer;
    margin-bottom: 16px;
    transition: 0.3s ease;
  }

  .add-btn:hover {
    transform: translateY(-3px);
    background: linear-gradient(90deg, #00bfff, #0077ff);
  }

  @media (max-width: 768px) {
    .hero-section { flex-direction: column; text-align: center; }
    .hero-section img { width: 100%; margin-top: 20px; }
  }
</style>

<!-- üè† Hero Section -->
<section class="hero-section">
  <div class="hero-text">
    <h1>Welcome to NK Mart</h1>
    <p>Find everything you need at unbeatable prices ‚Äî from electronics to fashion and beyond.</p>
  </div>
  <img src="https://cdn.pixabay.com/photo/2017/01/06/19/15/headphones-1953865_1280.jpg" alt="Shopping Hero">
</section>

<!-- üõçÔ∏è Categories -->
<section class="category-section">
  <h2>Shop by Category</h2>
  <div class="category-grid">
    <div class="category-card">
      <img src="https://cdn-icons-png.flaticon.com/512/1829/1829412.png" alt="Electronics">
      <p>Electronics</p>
    </div>
    <div class="category-card">
      <img src="https://cdn-icons-png.flaticon.com/512/892/892458.png" alt="Fashion">
      <p>Fashion</p>
    </div>
    <div class="category-card">
      <img src="https://cdn-icons-png.flaticon.com/512/1830/1830839.png" alt="Home Essentials">
      <p>Home Essentials</p>
    </div>
    <div class="category-card">
      <img src="https://cdn-icons-png.flaticon.com/512/3081/3081559.png" alt="Beauty">
      <p>Beauty & Care</p>
    </div>
  </div>
</section>

<!-- ‚ö° Flash Deals -->
<section class="flash-deals">
  <h2>Flash Deals</h2>
  <div class="product-grid">
    {% for product in featured_products %}
      <div class="product-card">
        {% if product.image %}
          <img src="{{ product.image }}" alt="{{ product.name }}">
        {% else %}
          <img src="https://via.placeholder.com/400x250?text=Product" alt="placeholder">
        {% endif %}
        <h3>{{ product.name }}</h3>
        <div class="price">‚Çπ{{ product.price }}</div>
        <button class="add-btn" data-product-id="{{ product.id }}">Add to Cart üõí</button>
      </div>
    {% empty %}
      <p style="grid-column: 1 / -1; text-align: center; color: var(--text-color);">No featured products available.</p>
    {% endfor %}
  </div>
</section>

<script>
async function addToCart(productId) {
  const csrftoken = getCookie("csrftoken");
  try {
    const response = await fetch("/add_to_cart/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": csrftoken,
      },
      credentials: "include",
      body: JSON.stringify({ product_id: productId }),
    });

    const data = await response.json();

    if (response.ok) {
      alert(`‚úÖ ${data.message}`);
    } else {
      alert(`‚ö†Ô∏è ${data.error || "Something went wrong."}`);
    }
  } catch (error) {
    console.error("Error adding to cart:", error);
    alert("Network error. Please try again later.");
  }
}

function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== "") {
    const cookies = document.cookie.split(";");
    for (let cookie of cookies) {
      cookie = cookie.trim();
      if (cookie.startsWith(name + "=")) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}
</script>
{% endblock %}
